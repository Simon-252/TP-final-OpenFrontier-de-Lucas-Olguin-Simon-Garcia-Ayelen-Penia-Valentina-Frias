<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Modo Oscuro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#4f46e5', // Indigo para elementos principales
                        'secondary': '#1f2937', // Gris oscuro para tarjetas
                        'background': '#0f172a', // Azul muy oscuro para el fondo
                        'text-light': '#f3f4f6', // Gris claro para texto
                        'danger': '#ef4444', // Rojo para acciones de peligro
                    },
                },
                fontFamily: {
                    sans: ['Inter', 'sans-serif'],
                },
            }
        }
    </script>
    <style>
        /* Estilos personalizados para Leaflet y elementos espec铆ficos */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; /* Fondo muy oscuro */
            color: #f3f4f6; /* Texto claro */
        }
        
        /* Estilo para que la tabla en modo oscuro se vea bien */
        .dark-table {
            --tw-bg-opacity: 1;
            background-color: rgb(31 41 55 / var(--tw-bg-opacity)); /* bg-secondary */
            color: #f3f4f6;
        }

        .dark-table thead th {
            color: #9ca3af; /* Gris m谩s suave para encabezados */
            border-bottom-color: #374151;
        }

        .dark-table tbody td {
            border-top-color: #374151;
        }

        .dark-table tbody tr:hover {
            background-color: #111827; /* Fondo m谩s oscuro al pasar el rat贸n */
        }

        /* Adaptaci贸n para pantallas peque帽as */
        @media (max-width: 768px) {
            #map {
                height: 300px;
            }
        }
    </style>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
</head>

<body class="bg-background min-h-screen text-text-light p-4 sm:p-6 lg:p-8">

    <nav class="bg-gray-800 shadow-xl rounded-lg mb-6 p-4">
        <div class="max-w-7xl mx-auto flex flex-wrap items-center justify-between gap-3">
            <a class="text-2xl font-bold text-white hover:text-primary transition duration-200" href="#">Dashboard</a>
            
            <div class="flex flex-wrap items-center gap-2 sm:gap-4 ml-auto">
                <a href="/" class="px-3 py-2 text-sm font-medium text-white bg-primary hover:bg-indigo-600 rounded-md transition duration-200">
                    Inicio
                </a> 
                <a href="/notifications" class="px-3 py-2 text-sm font-medium text-white bg-green-600 hover:bg-green-700 rounded-md transition duration-200">
                    <span class="inline-block align-middle">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                            <path d="M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zm-6 8a1 1 0 100 2h12a1 1 0 100-2H4zm5 9a1 1 0 01-1-1h4a1 1 0 01-1 1h-2z" clip-rule="evenodd" fill-rule="evenodd"></path>
                        </svg>
                    </span>
                    <span class="hidden sm:inline-block ml-1">Buz贸n y Soporte</span>
                </a> 
                <button id="logoutBtn" class="bg-danger hover:bg-red-600 text-white font-semibold py-2 px-3 rounded-md transition duration-200 text-sm">
                    Cerrar sesi贸n
                </button>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto">
        
        <div class="mb-6 bg-secondary p-4 rounded-lg shadow-lg">
            <h3 class="text-2xl font-semibold">Bienvenido, <span id="username" class="text-primary"></span>!</h3>
            <p class="text-gray-400">Tu Rol: <span id="role" class="font-medium capitalize"></span></p>
        </div>

        <div id="adminSection" class="space-y-6" style="display:none;">
            
            <div class="bg-secondary p-5 rounded-xl shadow-xl">
                <h5 class="text-xl font-bold mb-3 text-primary">Contenido Exclusivo para Administradores</h5>
                <p class="text-gray-300">Esta secci贸n solo es visible para usuarios con el rol 'admin'.</p>

                <h6 class="mt-6 text-lg font-semibold text-white"> Enviar Alerta Global</h6>
                <div class="bg-gray-700 p-4 rounded-lg mt-2">
                    <form id="globalAlertForm" class="space-y-4">
                        <div>
                            <label for="alertSubject" class="block text-sm font-medium text-gray-400">Asunto (Opcional)</label>
                            <input type="text" class="mt-1 block w-full rounded-md border-gray-600 bg-gray-800 text-text-light p-2 shadow-sm focus:border-primary focus:ring-primary" id="alertSubject" value="Alerta del Sistema">
                        </div>
                        <div>
                            <label for="alertBody" class="block text-sm font-medium text-gray-400">Mensaje de Alerta</label>
                            <textarea class="mt-1 block w-full rounded-md border-gray-600 bg-gray-800 text-text-light p-2 shadow-sm focus:border-primary focus:ring-primary" id="alertBody" rows="3" required></textarea>
                        </div>
                        <button type="submit" class="w-full sm:w-auto px-4 py-2 bg-danger hover:bg-red-600 text-white font-semibold rounded-md transition duration-200">
                            Enviar Alerta a TODOS
                        </button>
                    </form>
                </div>
            </div>

            <div class="bg-secondary p-5 rounded-xl shadow-xl">
                <h6 class="text-lg font-semibold mb-4 text-white">Gesti贸n de Usuarios</h6>
                
                <div class="grid grid-cols-1 sm:grid-cols-3 lg:grid-cols-4 gap-4 mb-6 items-end">
                    <div class="lg:col-span-2">
                        <label for="searchTerm" class="block text-sm font-medium text-gray-400">Buscar (Nombre, Email, ID)</label>
                        <input type="text" class="mt-1 block w-full rounded-md border-gray-600 bg-gray-800 text-text-light p-2 shadow-sm focus:border-primary focus:ring-primary" id="searchTerm" placeholder="Escribe nombre, email o ID...">
                    </div>
                    <div class="col-span-1">
                        <label for="filterRole" class="block text-sm font-medium text-gray-400">Filtrar por Rol</label>
                        <select class="mt-1 block w-full rounded-md border-gray-600 bg-gray-800 text-text-light p-2 shadow-sm focus:border-primary focus:ring-primary" id="filterRole">
                            <option value="">Todos</option>
                            <option value="admin">Administrador</option>
                            <option value="user">Usuario Regular</option>
                        </select>
                    </div>
                    <div class="col-span-1">
                        <button id="searchButton" class="w-full px-4 py-2 bg-primary hover:bg-indigo-600 text-white font-semibold rounded-md transition duration-200">
                            Aplicar Filtros
                        </button>
                    </div>
                </div>

                <div class="overflow-x-auto rounded-lg shadow-lg">
                    <table class="w-full dark-table table-auto">
                        <thead>
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider hidden lg:table-cell" id="th-id">ID</th>
                                
                                <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider">Username</th>
                                
                                <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider hidden lg:table-cell" id="th-email">Email</th>
                                
                                <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider hidden lg:table-cell" id="th-role">Role</th>
                                
                                <th class="px-4 py-3 text-center text-xs font-medium uppercase tracking-wider">Estado</th> 
                                <th class="px-4 py-3 text-center text-xs font-medium uppercase tracking-wider" style="min-width: 150px;">Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody" class="divide-y divide-gray-700">
                            <tr><td colspan="6" class="px-4 py-4 text-center text-gray-400">Cargando usuarios...</td></tr>
                        </tbody>
                    </table>
                </div>

                <div class="flex flex-col sm:flex-row justify-between items-center mt-4">
                    <small id="paginationInfo" class="text-gray-400 mb-2 sm:mb-0">Mostrando 0 de 0 usuarios.</small>
                    <nav>
                        <ul class="flex space-x-1" id="paginationControls">
                            </ul>
                    </nav>
                </div>
            </div>
        </div>
    </div> 
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    
    <script src="/static/js/dashboard.js"></script> 
    <script src="{{ url_for('static', filename='js/logout_handler.js') }}"></script>
</body>
</html>